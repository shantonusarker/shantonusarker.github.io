---
layout: post
title: Introduction to Junit Benchmark , a performance testing library for your unit
  tests
date: '2017-01-08T14:52:00.002+06:00'
author: Shantonu Sarker
tags:
- JAVA
- Java Language
- Performance Testing
- junit
modified_time: '2020-11-24T00:41:17.090+06:00'
thumbnail: https://3.bp.blogspot.com/-zZXzIqCyGbg/WHHsEFX7BmI/AAAAAAAACKU/oKjDtVot8ZAFnL90r3K45RPSgKQJ4SxywCK4B/s72-c/shantonu_Selection_264.jpg
blogger_id: tag:blogger.com,1999:blog-2902524569242410076.post-2488468004390267778
blogger_orig_url: https://shantonusarker.blogspot.com/2017/01/junit-benchmark.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><a href="https://sarkershantonu.github.io/2017/01/08/junit-benchmark/" target="_blank">New Blog Link</a></div><div dir="ltr" style="text-align: left;" trbidi="on">------------------<br /><br />In this article we are going to see how to use Junit Benchmark where can we perform small performance tests on existing unit tests. <br /><br /><span style="font-size: large;">What is Junit benchmark? </span><br />Junit Benchmark is a library for running your unit tests by multi threads. It has simple annotation to support this type of execution. It usages Junit Rule to drive multi threaded execution. <br /><br />So, idea is simple, if you use the rule and use the annotation you can easily benchmark a test method.<br /><br />You can apply this tests for Java 6,7,8. For Java 9, this has already accepted and part of JDK tool library as <b><a href="http://openjdk.java.net/projects/code-tools/jmh/" target="_blank">JMH</a>.</b> <br /><br /><span style="font-size: large;">Example to use it : </span><br /><br />Lets see an example to know&nbsp; how to use.<br />I am using a simple Calculator class with following methods. <br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public class </span>Calculator {<br />    <span style="color: navy; font-weight: bold;">public double </span>add(<span style="color: navy; font-weight: bold;">double </span>a, <span style="color: navy; font-weight: bold;">double </span>b){<br />        <span style="color: navy; font-weight: bold;">return </span>a+b;<br />    }<br />    <span style="color: navy; font-weight: bold;">public double </span>sub(<span style="color: navy; font-weight: bold;">double </span>a, <span style="color: navy; font-weight: bold;">double </span>b){<br />        <span style="color: navy; font-weight: bold;">return </span>a-b;<br />    }<br />    <span style="color: navy; font-weight: bold;">public double </span>mul(<span style="color: navy; font-weight: bold;">double </span>a, <span style="color: navy; font-weight: bold;">double </span>b){<br />        <span style="color: navy; font-weight: bold;">return </span>a*b;<br />    }<br />    <span style="color: navy; font-weight: bold;">public double </span>div(<span style="color: navy; font-weight: bold;">double </span>a, <span style="color: navy; font-weight: bold;">double </span>b){<br />        <span style="color: navy; font-weight: bold;">return </span>a/b;<br />    }<br />    <span style="color: navy; font-weight: bold;">public double </span>mod(<span style="color: navy; font-weight: bold;">double </span>a, <span style="color: navy; font-weight: bold;">double </span>b){<br />        <span style="color: navy; font-weight: bold;">return </span>a%b;<br />    }<br />}</pre><br />In the project , I add this dependency for junit benchmark along with other dependencies.&nbsp; <br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="background-color: #efefef;">&lt;</span><span style="background-color: #efefef; color: navy; font-weight: bold;">dependency</span><span style="background-color: #efefef;">&gt;</span><br />    <span style="background-color: #efefef;">&lt;</span><span style="background-color: #efefef; color: navy; font-weight: bold;">groupId</span><span style="background-color: #efefef;">&gt;</span>com.carrotsearch<span style="background-color: #efefef;">&lt;/</span><span style="background-color: #efefef; color: navy; font-weight: bold;">groupId</span><span style="background-color: #efefef;">&gt;</span><br />    <span style="background-color: #efefef;">&lt;</span><span style="background-color: #efefef; color: navy; font-weight: bold;">artifactId</span><span style="background-color: #efefef;">&gt;</span>junit-benchmarks<span style="background-color: #efefef;">&lt;/</span><span style="background-color: #efefef; color: navy; font-weight: bold;">artifactId</span><span style="background-color: #efefef;">&gt;</span><br />    <span style="background-color: #efefef;">&lt;</span><span style="background-color: #efefef; color: navy; font-weight: bold;">version</span><span style="background-color: #efefef;">&gt;</span>0.7.2<span style="background-color: #efefef;">&lt;/</span><span style="background-color: #efefef; color: navy; font-weight: bold;">version</span><span style="background-color: #efefef;">&gt;</span><br /><span style="background-color: #efefef;">&lt;/</span><span style="background-color: #efefef; color: navy; font-weight: bold;">dependency</span><span style="background-color: #efefef;">&gt;</span></pre><br />&nbsp;I have wrote a unit test for subtract method.<br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Test</span><br /><span style="color: navy; font-weight: bold;">public void </span>testSub(){<br />    Assert.<span style="font-style: italic;">assertEquals</span>(-<span style="color: blue;">5.0</span>, <span style="color: #660e7a; font-weight: bold;">aCalculator</span>.sub(<span style="color: blue;">10.0</span>,<span style="color: blue;">15.0</span>), <span style="color: blue;">0.01</span>);</pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;">}</pre><br /><br /><span style="font-size: large;">Now, How to use it?</span><br /><br /><b>Step 1 : </b>Add this Rule in your test class.<br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Rule</span><span style="color: navy; font-weight: bold;">public </span>TestRule <span style="color: #660e7a; font-weight: bold;">benchmarkRun </span>= <span style="color: navy; font-weight: bold;">new </span>BenchmarkRule();</pre><br /><b>Step 2.</b> Use this annotation before your junit tests.<br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@BenchmarkOptions</span>(concurrency = <span style="color: blue;">2</span>, warmupRounds = <span style="color: blue;">0</span>, benchmarkRounds = <span style="color: blue;">5</span>)</pre><br />&nbsp;And thats it. If you run, it will run your test with 2 concurrent threads.<br /><br />Now, let's see what we have done with benchmark options. You can there are 3 parameters<br /><br /><b>concurrency</b>(a number) = How many threads you want to use your test to be executed.<br /><br /><b>warmupRounds</b> (a number)=&gt; how many time you run the test to initialize your environment. How many threads you want to run before actual test starts. This is very important for testing stand point. Usually JVM based application need some initial time to start the process and JVM. So, you can add one or two threads to keep it realistic on timing that you observe. These rounds wont be calculated but, after the worm up round, you will get the timing with running environment.<br /><br /><b>benchmarkRounds</b> (a number) = How many iterations you want to run? <br /><br />If you are jmeter user, you may experienced similar parameters in thread groups.<br /><br />Now, in test case I put some thread delay to see my test running as the test is very small so, it will run very fast. After adding some delay, the test case becomes.<br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public class </span>PerfTest {<br />    <span style="color: navy; font-weight: bold;">protected </span>Calculator <span style="color: #660e7a; font-weight: bold;">aCalculator </span>= <span style="color: navy; font-weight: bold;">null</span>;<br /></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Before</span><span style="color: olive;">    </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public void </span>init(){<br />        <span style="color: #660e7a; font-weight: bold;">aCalculator </span>= <span style="color: navy; font-weight: bold;">new </span>Calculator();<br />    }    <span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Rule</span><span style="color: olive;">    </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public </span>TestRule <span style="color: #660e7a; font-weight: bold;">benchmarkRun </span>= <span style="color: navy; font-weight: bold;">new </span>BenchmarkRule();<br />    <span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Test</span><span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@BenchmarkOptions</span>(concurrency = <span style="color: blue;">2</span>, warmupRounds = <span style="color: blue;">0</span>, benchmarkRounds = <span style="color: blue;">5</span>)<br />    <span style="color: navy; font-weight: bold;">public void </span>testSub(){<br />        Assert.<span style="font-style: italic;">assertEquals</span>(-<span style="color: blue;">5.0</span>, <span style="color: #660e7a; font-weight: bold;">aCalculator</span>.sub(<span style="color: blue;">10.0</span>,<span style="color: blue;">15.0</span>), <span style="color: blue;">0.01</span>);<br />&nbsp;</pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: grey; font-style: italic;">//optional delays</span><span style="color: grey; font-style: italic;">        </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">try </span>{<br />            Thread.<span style="font-style: italic;">sleep</span>(<span style="color: blue;">1000</span>);<br />        } <span style="color: navy; font-weight: bold;">catch </span>(InterruptedException e) {<br />            e.printStackTrace();<br />        }    <br />    }<br />}</pre><br />And , if we run as Junit test from IDE, we can see this in output window (default logging) <br /><a href="http://3.bp.blogspot.com/-zZXzIqCyGbg/WHHsEFX7BmI/AAAAAAAACKU/oKjDtVot8ZAFnL90r3K45RPSgKQJ4SxywCK4B/s1600/shantonu_Selection_264.jpg"><img border="0" height="201" src="https://3.bp.blogspot.com/-zZXzIqCyGbg/WHHsEFX7BmI/AAAAAAAACKU/oKjDtVot8ZAFnL90r3K45RPSgKQJ4SxywCK4B/s640/shantonu_Selection_264.jpg" width="640" /></a><br /><br /><br /><span style="font-size: large;">Alternative ways to use :&nbsp;</span><br />A. You can extend any of your test class from AbstractBenchmark. Like<br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public class </span>TestCalculator <span style="color: navy; font-weight: bold;">extends </span>AbstractBenchmark {...} </pre><br />This AbstractBenchmark has this BenchmarkRule .<br /><br />B. You can&nbsp; also do that by your own base class with test rules and all testing parameters. I have one example for base class having test rule<br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public abstract class </span>Benchmarking {<br />    <span style="color: navy; font-weight: bold;">protected </span>Calculator <span style="color: #660e7a; font-weight: bold;">aCalculator </span>= <span style="color: navy; font-weight: bold;">null</span>;    <span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Rule</span><span style="color: olive;">    </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public </span>TestRule <span style="color: #660e7a; font-weight: bold;">benchmarkRun </span>= <span style="color: navy; font-weight: bold;">new </span>BenchmarkRule();    <span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Before</span><span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">&nbsp;</span><span style="color: navy; font-weight: bold;">public void </span>init(){<br />        <span style="color: #660e7a; font-weight: bold;">aCalculator </span>= <span style="color: navy; font-weight: bold;">new </span>Calculator();<br />    }<br />}</pre><br />And a test class extending that.<br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public class </span>PerfTest_custom <span style="color: navy; font-weight: bold;">extends </span>Benchmarking {<br />    <span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Test</span><span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@BenchmarkOptions</span>(concurrency = <span style="color: blue;">2</span>, warmupRounds = <span style="color: blue;">0</span>, benchmarkRounds = <span style="color: blue;">5</span>)<br />    <span style="color: navy; font-weight: bold;">public void </span>testSub(){<br />        Assert.<span style="font-style: italic;">assertEquals</span>(-<span style="color: blue;">5.0</span>, <span style="color: #660e7a; font-weight: bold;">aCalculator</span>.sub(<span style="color: blue;">10.0</span>,<span style="color: blue;">15.0</span>), <span style="color: blue;">0.01</span>);<br />        <span style="color: grey; font-style: italic;">//To run the test slow enough to see it running</span><span style="color: grey; font-style: italic;">        </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">     try </span>{<br />            Thread.<span style="font-style: italic;">sleep</span>(<span style="color: blue;">1000</span>);<br />        } <span style="color: navy; font-weight: bold;">catch </span>(InterruptedException e) {<br />            e.printStackTrace();<br />        }<br />    }<br />}</pre><br /><br />Example parameters :<br /><br /><b>@BenchmarkOptions(warmupRounds = 1,concurrency = 20, benchmarkRounds = 10)</b><br /><br />It will run :<br />1. Single iteration for worm up,<br />2. Then 20 threads will run the tests<br />3. The threads will continue for 10 times. <br /><br />So, Total it will run 20x10+1=401 times.<br /><br />To validate number of current thread, we can use <b>Thread.activeCount()</b> inside test function to print current thread number .<br /><br />We can actually use this annotation in both method level as well as class level.<br />&nbsp;A class level annotation actually apply for all test methods. where a method level annotation will override class level annotation if we use together.<br /><br /><b>Class level example :</b><br />&nbsp; <br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@BenchmarkOptions</span>(concurrency = <span style="color: blue;">2</span>, warmupRounds = <span style="color: blue;">2</span>, benchmarkRounds = <span style="color: blue;">20</span>)<br /><span style="color: navy; font-weight: bold;">public class </span>TestCalculator <span style="color: navy; font-weight: bold;">extends </span>AbstractBenchmark {<br />    <span style="color: navy; font-weight: bold;">private </span>Calculator <span style="color: #660e7a; font-weight: bold;">aCalculator </span>= <span style="color: navy; font-weight: bold;">null</span>;<br />    <span style="color: olive;">@Before</span><span style="color: olive;">    </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public void </span>init() {<br />        <span style="color: #660e7a; font-weight: bold;">aCalculator </span>= <span style="color: navy; font-weight: bold;">new </span>Calculator();<br />    }</pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;">&nbsp;<span style="color: olive;">@Test</span><span style="color: olive;">    </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public void </span>testAddition() {<br />        Assert.<span style="font-style: italic;">assertEquals</span>(<span style="color: blue;">25.0</span>, <span style="color: #660e7a; font-weight: bold;">aCalculator</span>.add(<span style="color: blue;">10.0</span>, <span style="color: blue;">15.0</span>), <span style="color: blue;">0.01</span>);<br />    }<br />    <span style="color: olive;">@Test</span><span style="color: olive;">    </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public void </span>testSub() {<br />        Assert.<span style="font-style: italic;">assertEquals</span>(-<span style="color: blue;">5.0</span>, <span style="color: #660e7a; font-weight: bold;">aCalculator</span>.sub(<span style="color: blue;">10.0</span>, <span style="color: blue;">15.0</span>), <span style="color: blue;">0.01</span>);<br />    }<br />}</pre><br /><b>Method Level Example :</b><br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public class </span>TestCalculator_MethodLevelExample <span style="color: navy; font-weight: bold;">extends </span>AbstractBenchmark{<br />    <span style="color: navy; font-weight: bold;">protected </span>Calculator <span style="color: #660e7a; font-weight: bold;">aCalculator </span>= <span style="color: navy; font-weight: bold;">null</span>;    <span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@Before</span><span style="color: olive;">    </span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public void </span>init(){<br />        <span style="color: #660e7a; font-weight: bold;">aCalculator </span>= <span style="color: navy; font-weight: bold;">new </span>Calculator();<br />    }<br />    <span style="color: olive;">@Test</span><span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@BenchmarkOptions</span>(concurrency = <span style="color: blue;">6</span>, warmupRounds = <span style="color: blue;">1</span>, benchmarkRounds = <span style="color: blue;">50</span>)<br />    <span style="color: navy; font-weight: bold;">public void </span>testAddition(){<br />        Assert.<span style="font-style: italic;">assertEquals</span>(<span style="color: blue;">25.0</span>, <span style="color: #660e7a; font-weight: bold;">aCalculator</span>.add(<span style="color: blue;">10.0</span>,<span style="color: blue;">15.0</span>), <span style="color: blue;">0.01</span>);<br />    }<br />    <br />    <span style="color: olive;">@Test</span><span style="color: olive;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@BenchmarkOptions</span>(concurrency = <span style="color: blue;">8</span>, warmupRounds = <span style="color: blue;">0</span>, benchmarkRounds = <span style="color: blue;">100</span>)<br />    <span style="color: navy; font-weight: bold;">public void </span>testSub(){<br />        Assert.<span style="font-style: italic;">assertEquals</span>(-<span style="color: blue;">5.0</span>, <span style="color: #660e7a; font-weight: bold;">aCalculator</span>.sub(<span style="color: blue;">10.0</span>,<span style="color: blue;">15.0</span>), <span style="color: blue;">0.01</span>);<br />    }<br />}</pre><br />Now, this class in <a href="https://github.com/sarkershantonu/Automation-Getting-Started/blob/master/junitbenchmark/src/test/java/org/performance/TestCalculator.java" target="_blank">my repository</a> has some extra item with it for reporting and testing delay purposes. We will see those later.<br /><br /><span style="font-size: large;">Bonus features : Result Storing &amp; Reporting :&nbsp;&nbsp;</span> <br /><br />This is common practices to show results of performance testing as report. Beside showing results in command line, junit benchmark has inbuilt capabilities to store your test results in H2 or mysql database. I will show examples with H2 Database. For this<br /><br /><b>Step 1 :</b> I am adding H2 database in my project POM.XML<br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="background-color: #efefef;">&lt;</span><span style="background-color: #efefef; color: navy; font-weight: bold;">dependency</span><span style="background-color: #efefef;">&gt;</span><br />    <span style="background-color: #efefef;">&lt;</span><span style="background-color: #efefef; color: navy; font-weight: bold;">groupId</span><span style="background-color: #efefef;">&gt;</span>com.h2database<span style="background-color: #efefef;">&lt;/</span><span style="background-color: #efefef; color: navy; font-weight: bold;">groupId</span><span style="background-color: #efefef;">&gt;</span><br />    <span style="background-color: #efefef;">&lt;</span><span style="background-color: #efefef; color: navy; font-weight: bold;">artifactId</span><span style="background-color: #efefef;">&gt;</span>h2<span style="background-color: #efefef;">&lt;/</span><span style="background-color: #efefef; color: navy; font-weight: bold;">artifactId</span><span style="background-color: #efefef;">&gt;</span><br />    <span style="background-color: #efefef;">&lt;</span><span style="background-color: #efefef; color: navy; font-weight: bold;">version</span><span style="background-color: #efefef;">&gt;</span>1.4.192<span style="background-color: #efefef;">&lt;/</span><span style="background-color: #efefef; color: navy; font-weight: bold;">version</span><span style="background-color: #efefef;">&gt;</span><br /><span style="background-color: #efefef;">&lt;/</span><span style="background-color: #efefef; color: navy; font-weight: bold;">dependency</span><span style="background-color: #efefef;">&gt;</span></pre><br /><b>Step 2 : </b>Put all Property information in jub.properties and load them before test. I am using my own base test case to load before class. <br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@BeforeClass</span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">public static void </span>loadProperties() <span style="color: navy; font-weight: bold;">throws </span>IOException {<br />    Properties p = <span style="color: navy; font-weight: bold;">new </span>Properties();<br />    p.load(<span style="color: navy; font-weight: bold;">new </span>FileInputStream(<span style="color: navy; font-weight: bold;">new </span>File(<span style="color: green; font-weight: bold;">"src/test/resources/jub.properties"</span>)));<br />    <span style="color: navy; font-weight: bold;">for</span>(String k:p.stringPropertyNames()){<br />        System.<span style="font-style: italic;">setProperty</span>(k,p.getProperty(k));<br />    }<br />}</pre><br />Define properties are :<br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="background-color: #e4e4ff; color: navy; font-weight: bold;">jub.ignore.annotations</span>=<span style="color: green; font-weight: bold;">false</span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">jub.ignore.callgc</span>=<span style="color: green; font-weight: bold;">true</span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">jub.consumers</span>=<span style="color: green; font-weight: bold;">CONSOLE,H2</span><span style="color: green; font-weight: bold;"></span><span style="color: navy; font-weight: bold;">&nbsp;</span></pre><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: navy; font-weight: bold;">jub.db.file</span>=<span style="color: green; font-weight: bold;">charts/.benchmarks</span><span style="color: grey; font-style: italic;"><br /></span><span style="color: navy; font-weight: bold;">jub.charts.dir</span>=<span style="color: green; font-weight: bold;">charts</span><span style="color: grey; font-style: italic;"><br /></span><span style="color: navy; font-weight: bold;">jub.customkey</span>=<span style="color: green; font-weight: bold;">AddBenchMark</span></pre><br />[You may see in my repository bout other properties which can be added]<br />So, we can see, the chart will be created in a chart folder under working directory (not maven build directory)<br /><br /><b>Step 3 : </b>Adding reporting annotation in the tests:<br />There are 3 annotations in test class level:<br /><br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="color: olive;">@AxisRange</span>(min = <span style="color: blue;">0</span>, max =<span style="color: blue;">1</span>)<br /><span style="color: olive;">@BenchmarkMethodChart</span>(filePrefix = <span style="color: green; font-weight: bold;">"benchmark-lists2"</span>)<br /><span style="color: olive;">@BenchmarkHistoryChart</span>(labelWith = LabelType.<span style="color: #660e7a; font-style: italic; font-weight: bold;">RUN_ID</span>, maxRuns = <span style="color: blue;">20</span>)</pre><br /><br />a. @AxisRange : It represent axix information of the graph that is shown. We can add min &amp; max values.<br /><a href="http://2.bp.blogspot.com/-EO2mGQJvrmo/WHH5YKSeiUI/AAAAAAAACK0/VmaP4O6gUysQQWiwdCmlMw3TvtQ-XWj6ACK4B/s1600/shantonu_Selection_266.jpg"><img border="0" height="275" src="https://2.bp.blogspot.com/-EO2mGQJvrmo/WHH5YKSeiUI/AAAAAAAACK0/VmaP4O6gUysQQWiwdCmlMw3TvtQ-XWj6ACK4B/s400/shantonu_Selection_266.jpg" width="400" /></a><br /><br />b.&nbsp; @BenchmarkMethodChart : It we provide name of the report that will be generated.<br /><br />c. @BenchmarkHistoryChart : It is used for telling how many history results will be included in DB and results. maxRun will be how many times and label with provide options to include different type of label in each entry. I have added Run ID as label. We can add TIMESTAMP and our own CUSTOM_KEY. This CUSTOM_KEY should be included in the jub.properties. <br />Here is the example, as you saw from my property, the custom key was <br /><pre style="background-color: white; color: black; font-family: &quot;dejavu sans mono&quot;; font-size: 9pt;"><span style="background-color: #e4e4ff; color: navy; font-weight: bold;">jub.customkey</span>=<span style="color: green; font-weight: bold;">AddBenchMark</span></pre><br />So, in the report , i can see also this<br /><br />&nbsp;<a href="http://3.bp.blogspot.com/-YA-3j12AjWw/WHH7upY5PPI/AAAAAAAACLA/NuZP6zaKgEQGrWKfr5rJYFYrpTY7XM-vwCK4B/s1600/shantonu_Selection_267.jpg"><img border="0" height="625" src="https://3.bp.blogspot.com/-YA-3j12AjWw/WHH7upY5PPI/AAAAAAAACLA/NuZP6zaKgEQGrWKfr5rJYFYrpTY7XM-vwCK4B/s640/shantonu_Selection_267.jpg" width="640" /></a><br /><br />After running several rests , my chart folder looks like this.<br /><br />&nbsp;<a href="http://1.bp.blogspot.com/-YAVkwsyBL1I/WHHyMvE3KsI/AAAAAAAACKk/3uB2qXFJmRcdwdMf3PmXhi08bUnYZcSPgCK4B/s1600/shantonu_Selection_265.jpg"><img border="0" src="https://1.bp.blogspot.com/-YAVkwsyBL1I/WHHyMvE3KsI/AAAAAAAACKk/3uB2qXFJmRcdwdMf3PmXhi08bUnYZcSPgCK4B/s1600/shantonu_Selection_265.jpg" /></a><br /><br />&nbsp;In here the jsonp file contains results as json type object. You can also parse this to show with your json based live dashboard (like grafana).<br /><br /><br /><span style="font-size: large;">Where to use this ? </span><br />1. You have your unit tests, use this to know your concurrency state performance.<br />As this is unit level performance, this will not prove concurrent user actions but, it can prove concurrent request processing.<br />So, when you have Strict SLA , use this to validate throughput. <br />This type of test is not suitable for Response Time SLAs as this is not user time. <br />And , important factor, error rate or error tolerant. This type of test can ensure (mostly) about server's error possibility. <br /><br />2. You have functional integration tests which validates backend request. Like DB request, web service calls via UI layer. <br />you can use this to to test before actual tests for performance. This will help you to know how system behaves when they are integrated .<br />Some time it is very useful to run with manual tests in QA environment.<br />A number of parallel request is going on while a manual tester is testing application UI behavior. <br />&nbsp;&nbsp; <br />3. Mission critical/Business critical data concurrency tests can be easily done by this. <br />Example, business transaction data concurrency testing for a banking or financial domain. This can validate data integrity when concurrent requests are in place in the system. (Synchronization, locks etc)<br />&nbsp;&nbsp; <br />4. simulate thread deadlock scenario <br /><br />5. simulate OOM scenario<br /><br />6. Testing individual component, tire, request for Throughput and Error%<br /><br />7. Simulate Required Resource Capacity scenario.<br /><br />Note : While running the tests, make sure of resources that you are using in the test which will be affected by concurrency. Usually DB connections, file handlers, open ports, created sessions etc should be taken care properly for testing this way. <br /><br /><br /><a href="https://github.com/sarkershantonu/Automation-Getting-Started/tree/master/junitbenchmark" target="_blank"><b>My Github Project Link :https://github.com/sarkershantonu/Automation-Getting-Started/tree/master/junitbenchmark</b></a><br /><br />Main project link : http://labs.carrotsearch.com/junit-benchmarks-tutorial.html<br /><br /><br />-----  Thanks.. :) </div><div class="blogger-post-footer">Thanks for reading my personal blog. contact: shantonu_oxford@yahoo.com</div>